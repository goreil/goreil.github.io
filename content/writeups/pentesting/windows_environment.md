+++
title = 'Setting up Windows environment for pentesting'
date = 2024-10-22T22:33:49+02:00
draft = false
tags = ['tooling']
+++

# Introduction
So playing a lot of [Vulnlab](https://www.vulnlab.com/) or even 
real life assessments made me realize that I need a dedicated 
Windows environment for testing.

This would be required for a few tasks:
1. Opening specialized Windows files like encrypted Microsoft access databases.
2. Compiling windows exploits like [Perfusion](https://github.com/itm4n/Perfusion)
3. Testing Payloads, i.e. cmd reverse shells or DLL hijacking

# My Recommendation: Windows development environment
After spending a day on the task here is what worked for me:
I recommend the [Windows development environment](https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/), a pre-packaged Virtual Machine. Here is what it looks like in VirtualBox:

![Desktop Virtual Machine](/images/windows_environment/Windows_Virtual_Machine.png)

It's really easy to set up and works immediately after opening.
That's it! 

The caveat is that the fresh Windows machine is already taking up 50 GB storage space.
```bash
$ du -h
472K	./WinDev2404Eval/Logs
50G	./WinDev2404Eval
50G	.
```

Here are two alternative ideas that I discarded during the process.

# 1. Windows in the Cloud: Free Tier AWS EC2 Instance
So a cloud instance of a Windows Host sounds great. 
Not waiting for the 22 GB download and in general not wasting storage space for the actual VM Disk. 
Also still works if RAM is a limiting factor.
I chose AWS since a friend recommended it to me.

However, I realized it comes with a few more caveats attached:
1. The account setup takes more time than expected. I had to download a specialized RDP software and AWS has a lot of configuration options.
2. Free tier offers only a weak PC: 2 vCPU's and 1GiB of RAM is certainly not powerful. It was already laggy when I opened a Browser.
![AWS](/images/windows_environment/AWS.png)
3. Not knowing if you might get billed anyway *feels* stressful. 

Reason 2 was ultimately the reason why I currently decided against a Cloud VM

# 2. Wine - Running the Executables on my host system
On the opposite end, there is [Wine](https://www.winehq.org/), which according to the website stands for "Wine is Not an Emulator", haha :D.

While that's pretty funny I spent like one hour trying to get
[dnSpy](https://github.com/dnSpy/dnSpy) on Wine running before 
I decided that it's just not worth my time.

Here is how it looks like for me when I run
```bash
wine dnspy.exe
```

![dnspy error messages](/images/windows_environment/dnspy.png)

That was already the second error message after going through 
a tedious installation process so that was enough for me.